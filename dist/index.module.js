import{casUpdateData as t,computeFetchData as e,casFetchRows as n,computeSetup as r,computeSetupTables as o,casSetup as s,caslRun as a}from"@sassoftware/restaflib";import{initStore as i}from"@sassoftware/restaf";import u from"deepmerge";function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l.apply(this,arguments)}var c=function(t,e,n,r){try{var o=r.appControl.editControl.handlers;return null==o[t]?Promise.resolve([e,{statusCode:0,msg:null}]):Promise.resolve(o[t](e,n,r,t)).then(function(t){return[t[0],t[1]]})}catch(t){return Promise.reject(t)}},f=function(e,n){try{var r,o="cas"===n.source?Promise.resolve(function(e,n){try{var r=n.store,o=n.session,s=n.appControl,a=s.table,i=s.byvars,u=n.state.columns;if(null===i||0===i.length)return Promise.resolve(null);var l={};for(var c in e)"_index_"!==c&&!1===u[c].custom&&(l[c]=e[c]);var f={};return i.forEach(function(t){f[t]=l[t]}),Promise.resolve(t(r,o,{table:a,data:l,where:f})).then(function(t){var e={statusCode:0,msg:"Save successful"};return"Normal"!==t.items().toJS().disposition.severity&&(e.statusCode=2,e.msg=l.disposition.severity.reason),e})}catch(t){return Promise.reject(t)}}(e,n)).then(function(t){r=t}):Promise.resolve(function(t,e){try{var n=e.store,r=e.session,o=e.appControl,s=o.table,a=o.byvars,i=e.state.columns;if(null===a||0===a.length)return Promise.resolve(null);var u="proc sql; update "+s.libref+"."+s.name,l="SET ",c=" ";for(var f in t)!1===i[f].custom&&(l=l+c+f+"="+m(t[f])),c=", ";u=u+" "+l;var v=" WHERE ",h=" ";a.forEach(function(e){v=v+h+e+"="+m(t[e]),h="AND "});var d={data:{code:(u=u+" "+v+";run;").split(/\r?\n/)}};return Promise.resolve(n.apiCall(r.links("execute"),d)).then(function(t){return Promise.resolve(n.jobState(t,{qs:{newState:"Completed",timeout:1}})).then(function(t){return{statusCode:"completed"===t.data?0:1,msg:t.data}})})}catch(t){return Promise.reject(t)}}(e,n)).then(function(t){r=t});return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(t){return Promise.reject(t)}};function m(t){return null==t?".":"string"==typeof t?JSON.stringify(t):t.toString()}var v=function(t,e,n,r,o){try{var s,a=function(t){return s?t:Promise.resolve(c("main",i,n,o)).then(function(t){var e;function r(r){return e?r:(i=t[0],!0===o.appControl.cachePolicy&&(o.state.data[n]=i),{data:i,status:h})}var s=function(){if(!0===v)return Promise.resolve(c("term",t[0],n,o)).then(function(n){return 2===(h=(t=n)[1]).statusCode?(e=1,{data:t[0],status:h}):Promise.resolve(f(t[0],o)).then(function(t){h=t})})}();return s&&s.then?s.then(r):r(s)})},i=l({},null!==r?r:o.state.data[n]),u=o.appControl.editControl,m=u.handlers,v=u.autoSave;i[t]=function(t,e){var n=t,r=e.type.toLowerCase();return"string"!=typeof n||"decimal"!==r&&"number"!==r&&"double"!==r&&"float"!==r||(n=parseFloat(1*t),!0===isNaN(t)&&(t=0)),n}(e,o.state.columns[t]);var h={statusCode:0,msg:""},d=function(){if(null!=m[t])return Promise.resolve(m[t](i,t,n,o)).then(function(t){if(i=t[0],2===(h=t[1]).statusCode)return s=1,{data:t[0],status:h}})}();return Promise.resolve(d&&d.then?d.then(a):a(d))}catch(t){return Promise.reject(t)}};function h(t,e,n){if(!t.s){if(n instanceof p){if(!n.s)return void(n.o=h.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(h.bind(null,t,e),h.bind(null,t,2));t.s=e,t.v=n;var r=t.o;r&&r(t)}}var d=function(t,e){try{var n=function(){var t={};if(r.forEach(function(e,n){var r=e.Column.toLowerCase();e.name=r,e.Label=null==e.Label||0===e.Label.length?e.Column:e.Label,null==e.type&&(e.type=e.Type),e.custom=!1,t[r]=e}),null!=s)for(var e in s){var n=l({},s[e]);n.name=e,n.custom=!0,t[e]=n}return{columns:t,data:i,status:a}},r=t.schema,o=t.rows,s=e.appControl.customColumns,a={statusCode:0,msg:"Initialization was successful"},i=[],u=(f=o,m=function(t){var n=function(t,e){var n={};if(e.forEach(function(e,r){var o=t[r],s=o.Column.toLowerCase();null==o.Label&&(o.Label=o.Column),n[s]=e}),null!=s)for(var r in s){var o=s[r],a=o.Column.toLowerCase();n[a]=o.value}return n}(r,o[t]);return Promise.resolve(c("init",n,t,e)).then(function(t){a=t[1],i.push(t[0])})},P=-1,function t(e){try{for(;++P<f.length;)if((e=m(P))&&e.then){if(!((n=e)instanceof p&&1&n.s))return void e.then(t,d||(d=h.bind(null,v=new p,2)));e=e.v}v?h(v,1,e):v=e}catch(t){h(v||(v=new p),2,t)}var n}(),v);return Promise.resolve(u&&u.then?u.then(n):n())}catch(t){return Promise.reject(t)}var f,m,v,d,P};const p=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,n){const r=new t,o=this.s;if(o){const t=1&o?e:n;if(t){try{h(r,1,t(this.v))}catch(t){h(r,2,t)}return r}return this}return this.o=function(t){try{const o=t.v;1&t.s?h(r,1,e?e(o):o):n?h(r,1,n(o)):h(r,2,o)}catch(t){h(r,2,t)}},r},t}();var P=function(t,r){try{var o=null,s="cas"===r.source?Promise.resolve(function(t,e){try{var r=e.store,o=e.session,s=l({},t);return s.from<=0||-1===s.next?Promise.resolve(null):Promise.resolve(n(r,o,s)).then(function(t){var n=null,r=function(){if(null!==t)return Promise.resolve(d(t.data,e)).then(function(r){n=r,e.state={modified:[],pagination:l({},t.pagination),currentPage:s,data:[],columns:[]},!0===e.appControl.cachePolicy&&(e.state.data=n.data,e.state.columns=n.columns),n.pagination=l({},t.pagination)})}();return r&&r.then?r.then(function(){return n}):n})}catch(t){return Promise.reject(t)}}(t,r)).then(function(t){o=t}):Promise.resolve(function(t,n){try{var r=n.store,o=n.tableSummary,s=n.appControl.table,a=(s.libref+"."+s.name).toLowerCase();return Promise.resolve(e(r,o,a,null,{qs:{start:t.from-1,limit:t.count,format:null==t.format&&t.format}})).then(function(t){var e=null,r=function(){if(null!==t)return Promise.resolve(d(t,n)).then(function(t){n.state={modified:[],pagination:{},currentPage:{},data:(e=t).data,columns:e.columns}})}();return r&&r.then?r.then(function(){return e}):e})}catch(t){return Promise.reject(t)}}(t,r)).then(function(t){o=t});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(t){return Promise.reject(t)}},y=function(t,r,o){try{var s,a="cas"===r.source?Promise.resolve(function(t,e,r){try{var o,s=e.store,a=e.session,i=e.appControl,u=i.table;return"first"===t?o=l({},i.initialFetch):null!==t&&(o=l({},e.state.pagination[t])),null!=r&&(o=l({},r)),-1===o.next||o.from<=0?Promise.resolve(null):(o.table=u,Promise.resolve(n(s,a,o)).then(function(t){var n=null;return function(){if(null!==t)return Promise.resolve(d(t.data,e)).then(function(r){return n=r,e.state={modified:[],pagination:l({},t.pagination),currentPage:o,data:[],columns:[]},!0===e.appControl.cachePolicy&&(e.state.data=n.data,e.state.columns=n.columns),n.pagination=l({},t.pagination),n})}()}))}catch(t){return Promise.reject(t)}}(t,r,o)).then(function(t){s=t}):Promise.resolve(function(t,n,r){try{var o=n.store,s=n.tableSummary,a=n.appControl,i=a.table,u=a.initialFetch,c=null,f=(i.libref+"."+i.name).toLowerCase();return null==r?"first"===t&&(c=l({},u)):c=l({},r),Promise.resolve(e(o,s,f,t,c)).then(function(t){var e=null,r=function(){if(null!==t)return Promise.resolve(d(t,n)).then(function(t){n.state={modified:[],pagination:{},currentPage:{},data:(e=t).data,columns:e.columns}})}();return r&&r.then?r.then(function(){return e}):e})}catch(t){return Promise.reject(t)}}(t,r,o)).then(function(t){s=t});return Promise.resolve(a&&a.then?a.then(function(){return s}):s)}catch(t){return Promise.reject(t)}},g=function(t,e,n){try{var a,l=i();null==t.authType&&(t.authType="code");var c="cas"===e.source?Promise.resolve(function(t,e,n){try{return Promise.resolve(s(t,e)).then(function(r){return{source:n.source,store:t,session:r.session,servers:r.servers,restaflib:null,logonPayload:e,appControl:n,state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})}catch(t){return Promise.reject(t)}}(l,t,e)).then(function(t){a=t}):Promise.resolve(function(t,e,n,s){try{return Promise.resolve(r(t,n.computeContext,e)).then(function(r){return Promise.resolve(o(t,r,n.table,s)).then(function(o){return{source:n.source,store:t,session:r,tableSummary:o,servers:null,restaflib:null,logonPayload:e,appControl:u(n),state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})})}catch(t){return Promise.reject(t)}}(l,t,e,n)).then(function(t){a=t});return Promise.resolve(c&&c.then?c.then(function(){return a}):a)}catch(t){return Promise.reject(t)}},b=function(t,e,n){try{return Promise.resolve(a(e.store,e.session,"\n  results = selectionLists(_args_.column,_args_.table.caslib, _args_.table.name);\n  send_response({casResults = {data=results}});\n  ",{table:e.appControl.table,column:t},!0)).then(function(t){if(0!==t.results.casResults.data.statusCode)throw"Failed to create unique list";return t.results.casResults.data.data})}catch(t){return Promise.reject(t)}};export{b as casTableUnique,v as cellEdit,c as commonHandler,P as fetchTableRows,y as scrollTable,g as setup,f as updateTableRows};
//# sourceMappingURL=index.module.js.map
