import{casUpdateData as e,computeUpdateData as n,computeFetchData as t,casFetchRows as r,computeSetup as o,computeSetupTables as s,casSetup as i,caslRun as u,casUpload as a,casAppendTable as c,computeRun as l}from"@sassoftware/restaflib";import{initStore as f}from"@sassoftware/restaf";import m from"deepcopy";function v(){return v=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},v.apply(this,arguments)}var h=function(e,n,t,r){try{var o=r.appControl.editControl.handlers;return null==o[e]?Promise.resolve([n,{statusCode:0,msg:null}]):Promise.resolve(o[e](n,t,r,e)).then(function(e){return[e[0],e[1]]})}catch(e){return Promise.reject(e)}};function d(e,n,t){if(!e.s){if(t instanceof p){if(!t.s)return void(t.o=d.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(d.bind(null,e,n),d.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}var P=function(t,r){try{var o=r.store,s=r.session,i="cas"===r.source?e:n,u=function(e,n){var t=n.appControl,r=t.table,o=t.byvars,s=n.state.columns,i={};for(var u in e)"_index_"!==u&&"_rowIndex"!==u&&!1===s[u].custom&&(i[u]=e[u]);var a={};return o.forEach(function(e){a[e]=i[e]}),{table:r,data:i,where:a}}(t,r);return Promise.resolve(i(o,s,u))}catch(e){return Promise.reject(e)}},p=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,o=this.s;if(o){var s=1&o?n:t;if(s){try{d(r,1,s(this.v))}catch(e){d(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?d(r,1,n?n(o):o):t?d(r,1,t(o)):d(r,2,o)}catch(e){d(r,2,e)}},r},e}(),y=function(e,n){try{var t,r=n.appControl.byvars;if(null===r||0===r.length)return Promise.resolve([null,{msg:"Error: Please specify a by variable",statusCode:1}]);var o=function(){if(!0!==Array.isArray(e))return Promise.resolve(P(e,n)).then(function(e){t=e});var r,o,s,i,u,a=(r=e,o=function(r){return Promise.resolve(P(e[r],n)).then(function(e){t=e})},u=-1,function e(n){try{for(;++u<r.length;)if((n=o(u))&&n.then){if(!((t=n)instanceof p&&1&t.s))return void n.then(e,i||(i=d.bind(null,s=new p,2)));n=n.v}s?d(s,1,n):s=n}catch(e){d(s||(s=new p),2,e)}var t}(),s);return a&&a.then?a.then(function(){}):void 0}();return Promise.resolve(o&&o.then?o.then(function(){return t}):t)}catch(e){return Promise.reject(e)}},b=function(e,n,t,r,o){try{var s,i=function(e){return s?e:Promise.resolve(h("main",u,t,o)).then(function(e){var n;function s(t){return n?t:(u=e[0],!0===o.appControl.cachePolicy&&(o.state.data[r._rowIndex]=u),{data:u,status:f})}var i=function(){if(!0===l)return Promise.resolve(h("term",e[0],t,o)).then(function(t){return 2===(f=(e=t)[1]).statusCode?(n=1,{data:e[0],status:f}):Promise.resolve(y(e[0],o)).then(function(e){f=e})})}();return i&&i.then?i.then(s):s(i)})},u=v({},r),a=o.appControl.editControl,c=a.handlers,l=a.autoSave;u[e]=function(e,n){var t=e,r=n.Type.toLowerCase();return"string"!=typeof t||"decimal"!==r&&"number"!==r&&"double"!==r&&"float"!==r||(t=parseFloat(1*e),!0===isNaN(e)&&(e=0)),t}(n,o.state.columns[e]);var f={statusCode:0,msg:""},m=function(){if(null!=c[e])return Promise.resolve(c[e](u,e,t,o)).then(function(e){if(u=e[0],2===(f=e[1]).statusCode)return s=1,{data:e[0],status:f}})}();return Promise.resolve(m&&m.then?m.then(i):i(m))}catch(e){return Promise.reject(e)}};function g(e,n,t){if(!e.s){if(t instanceof j){if(!t.s)return void(t.o=g.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(g.bind(null,e,n),g.bind(null,e,2));e.s=n,e.v=t;var r=e.o;r&&r(e)}}var C=function(e,n){try{var t=function(){var e={};if(r.forEach(function(n,t){var r=n.Column.toLowerCase();n.name=r,n.Label=null==n.Label||0===n.Label.length?n.Column:n.Label,null==n.Type&&(n.Type=null==n.type?"double":n.type),n.custom=!1,e[r]=n}),null!=s)for(var n in s){var t=v({},s[n]);t.name=n,t.custom=!0,e[n]=t}return{columns:e,data:u,status:i}},r=e.schema,o=e.rows,s=n.appControl.customColumns,i={statusCode:0,msg:"Initialization was successful"},u=[],a=(c=o,l=function(e){var t=function(e,n,t){var r={_rowIndex:t};if(n.forEach(function(n,t){var o=e[t].Column.toLowerCase();r[o]=n}),null!=s)for(var o in s){var i=s[o],u=i.Column.toLowerCase();r[u]=i.value}return r}(r,o[e],e);return Promise.resolve(h("init",t,e,n)).then(function(e){i=e[1],u.push(e[0])})},d=-1,function e(n){try{for(;++d<c.length;)if((n=l(d))&&n.then){if(!((t=n)instanceof j&&1&t.s))return void n.then(e,m||(m=g.bind(null,f=new j,2)));n=n.v}f?g(f,1,n):f=n}catch(e){g(f||(f=new j),2,e)}var t}(),f);return Promise.resolve(a&&a.then?a.then(t):t())}catch(e){return Promise.reject(e)}var c,l,f,m,d};const j=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){const r=new e,o=this.s;if(o){const e=1&o?n:t;if(e){try{g(r,1,e(this.v))}catch(e){g(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?g(r,1,n?n(o):o):t?g(r,1,t(o)):g(r,2,o)}catch(e){g(r,2,e)}},r},e}();var w=function(e,n){try{var o=null,s="cas"===n.source?Promise.resolve(function(e,n){try{var t=n.store,o=n.session,s=v({},e);return s.from<=0||-1===s.next?Promise.resolve(null):(null==s.where&&(s.where=" "),Promise.resolve(r(t,o,s)).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(C(e.data,n)).then(function(r){t=r,n.state={modified:[],pagination:v({},e.pagination),currentPage:s,data:[],columns:[]},!0===n.appControl.cachePolicy&&(n.state.data=t.data,n.state.columns=t.columns),t.pagination=v({},e.pagination)})}();return r&&r.then?r.then(function(){return t}):t}))}catch(e){return Promise.reject(e)}}(e,n)).then(function(e){o=e}):Promise.resolve(function(e,n){try{var r=n.store,o=n.tableSummary,s=n.appControl.table,i=(s.libref+"."+s.name).toLowerCase();return Promise.resolve(t(r,o,i,null,{qs:{start:e.from-1,limit:e.count,format:null==e.format&&e.format}})).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(C(e,n)).then(function(e){n.state={modified:[],pagination:{},currentPage:{},data:(t=e).data,columns:t.columns}})}();return r&&r.then?r.then(function(){return t}):t})}catch(e){return Promise.reject(e)}}(e,n)).then(function(e){o=e});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(e){return Promise.reject(e)}},_=function(e,n,o){try{var s,i="cas"===n.source?Promise.resolve(function(e,n,t){try{var o,s=n.store,i=n.session,u=n.appControl,a=u.table;if("first"===e)o=v({},u.initialFetch);else if(null!==e&&(-1===(o=v({},n.state.pagination[e])).next||o.from<=0))return Promise.resolve(null);return null!=t&&(o=v({},t)),o.table=a,Promise.resolve(r(s,i,o)).then(function(e){var t=null;return function(){if(null!==e)return Promise.resolve(C(e.data,n)).then(function(r){return t=r,n.state={modified:[],pagination:v({},e.pagination),currentPage:o,data:[],columns:[]},!0===n.appControl.cachePolicy&&(n.state.data=t.data,n.state.columns=t.columns),t.pagination=v({},e.pagination),t})}()})}catch(e){return Promise.reject(e)}}(e,n,o)).then(function(e){s=e}):Promise.resolve(function(e,n,r){try{var o=n.store,s=n.tableSummary,i=n.appControl,u=i.table,a=i.initialFetch,c=null,l=(u.libref+"."+u.name).toLowerCase();return null==r?"first"===e&&(c=v({},a)):c=v({},r),Promise.resolve(t(o,s,l,e,c)).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(C(e,n)).then(function(e){n.state={modified:[],pagination:{},currentPage:{},data:(t=e).data,columns:t.columns}})}();return r&&r.then?r.then(function(){return t}):t})}catch(e){return Promise.reject(e)}}(e,n,o)).then(function(e){s=e});return Promise.resolve(i&&i.then?i.then(function(){return s}):s)}catch(e){return Promise.reject(e)}},L=function(e,n,t){try{var r,u=f();null==e.authType&&(e.authType="code");var a="cas"===n.source?Promise.resolve(function(e,n,t,r){try{return Promise.resolve(i(e,n)).then(function(r){return{source:t.source,store:e,session:r.session,servers:r.servers,restaflib:null,logonPayload:n,appControl:m(t),state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})}catch(e){return Promise.reject(e)}}(u,e,n)).then(function(e){r=e}):Promise.resolve(function(e,n,t,r){try{return Promise.resolve(o(e,t.computeContext,n)).then(function(o){return Promise.resolve(s(e,o,t.table,r)).then(function(r){return{source:t.source,store:e,session:o,tableSummary:r,servers:null,restaflib:null,logonPayload:n,appControl:m(t),state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})})}catch(e){return Promise.reject(e)}}(u,e,n,t)).then(function(e){r=e});return Promise.resolve(a&&a.then?a.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},x=function(e,n,t,r){try{var o,s="cas"===t.source?Promise.resolve(function(e,n,t,r){try{return Promise.resolve(u(t.store,t.session,"\n  results = selectionLists(_args_.column,_args_.table.caslib, _args_.table.name);\n  send_response({casResults = {data=results}});\n  ",{table:e,column:n},!0)).then(function(e){if(0!==e.results.casResults.data.statusCode)throw"Failed to create unique list";return e.results.casResults.data.data})}catch(e){return Promise.reject(e)}}(e,n,t)).then(function(e){o=e}):Promise.resolve(function(e,n,t){try{var r={};return r[e]=[],Promise.resolve(r)}catch(e){return Promise.reject(e)}}(e)).then(function(e){o=e});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(e){return Promise.reject(e)}},E=function(e,n,t,r,o,s,i){try{var u=o.store,f=o.session,m=Object.keys(n[0]),h=["_index_","_rowIndex"];null!==t&&(h=h.concat(t));var d=m.filter(function(e){return!(h.indexOf(e)>=0)}),P={};d.forEach(function(e){P[e]=o.state.columns[e]});var p=null;"cas"===o.source&&(p=d.join(",")+"\n");for(var y,b=function(e){var t=n[e];t=v({},t,r);var o=[];d.forEach(function(e,n){var r=t[e];"string"==typeof r&&(r=r.trim()),o[n]=r}),p=null===p?o.join(",")+"\n":p+o.join(",")+"\n"},g=0;g<n.length;g++)b(g);var C="cas"===o.source?Promise.resolve(function(e,n,t,r,o,s){try{return Promise.resolve(a(e,n,null,t.caslib+"."+t.name,!0,r)).then(function(r){return null!=o?Promise.resolve(c(e,n,t,o,s)).then(function(e){return r=e}):r})}catch(e){return Promise.reject(e)}}(u,f,e,p,s,i)).then(function(e){y=e}):Promise.resolve(function(e,n,t,r,o){try{var s="data "+r.libref+"."+r.name+"; INFILE datalines delimiter=',' ;\n",i="",u="INPUT ";for(var a in t){var c=t[a];u=u+c.Column+" ","CHAR"===c.Type&&(i=i+"  "+c.Column+" $ "+c.length+" \n")}return i.length>0&&(i="LENGTH "+i+";\n"),s=s+";\n"+i+(u+=";\n")+"datalines;\n"+o+"\n; run; proc print;run;\n",Promise.resolve(l(e,n,s)).then(function(){return{msg:"done",statusCode:0}})}catch(e){return Promise.reject(e)}}(u,f,P,e,p)).then(function(e){y=e});return Promise.resolve(C&&C.then?C.then(function(){return y}):y)}catch(e){return Promise.reject(e)}},I=function(e,n,t){return Promise.resolve([])};export{b as cellEdit,h as commonHandler,x as distinctValues,w as fetchTableRows,_ as scrollTable,L as setup,I as sort,y as updateTableRows,E as uploadData};
//# sourceMappingURL=index.module.js.map
