!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@sassoftware/restaflib"),require("@sassoftware/restaf"),require("deepcopy")):"function"==typeof define&&define.amd?define(["exports","@sassoftware/restaflib","@sassoftware/restaf","deepcopy"],t):t((e||self).restafedit={},e.restaflib,e.restaf,e.deepcopy)}(this,function(e,t,n,r){function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=/*#__PURE__*/o(r);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}var u=function(e,t,n,r){try{var o=r.appControl.editControl.handlers;return null==o[e]?Promise.resolve([t,{statusCode:0,msg:null}]):Promise.resolve(o[e](t,n,r,e)).then(function(e){return[e[0],e[1]]})}catch(e){return Promise.reject(e)}};function i(e,t,n){if(!e.s){if(n instanceof l){if(!n.s)return void(n.o=i.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(i.bind(null,e,t),i.bind(null,e,2));e.s=t,e.v=n;const r=e.o;r&&r(e)}}var c=function(e,n){try{var r=n.store,o=n.session,s="cas"===n.source?t.casUpdateData:t.computeUpdateData,a=function(e,t){var n=t.appControl,r=n.table,o=n.byvars,s=t.state.columns,a={};for(var u in e)"_index_"!==u&&"_rowIndex"!==u&&!1===s[u].custom&&(a[u]=e[u]);var i={};o.forEach(function(e){i[e]=a[e]});var c={table:r,data:a,where:i};return console.log(JSON.stringify(c,null,4)),c}(e,n);return console.log(JSON.stringify(a,null,4)),console.log(a),console.log(s),Promise.resolve(s(r,o,a)).then(function(e){return console.log(e),e})}catch(e){return Promise.reject(e)}},l=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var s=1&o?t:n;if(s){try{i(r,1,s(this.v))}catch(e){i(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?i(r,1,t?t(o):o):n?i(r,1,n(o)):i(r,2,o)}catch(e){i(r,2,e)}},r},e}(),f=function(e,t){try{var n,r=t.appControl.byvars;if(null===r||0===r.length)return Promise.resolve([null,{msg:"Error: Please specify a by variable",statusCode:1}]);var o=function(){if(!0!==Array.isArray(e))return Promise.resolve(c(e,t)).then(function(e){n=e});var r,o,s,a,u,f=(r=e,o=function(r){return Promise.resolve(c(e[r],t)).then(function(e){n=e})},u=-1,function e(t){try{for(;++u<r.length;)if((t=o(u))&&t.then){if(!((n=t)instanceof l&&1&n.s))return void t.then(e,a||(a=i.bind(null,s=new l,2)));t=t.v}s?i(s,1,t):s=t}catch(e){i(s||(s=new l),2,e)}var n}(),s);return f&&f.then?f.then(function(){}):void 0}();return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(e){return Promise.reject(e)}};function m(e,t,n){if(!e.s){if(n instanceof v){if(!n.s)return void(n.o=m.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(m.bind(null,e,t),m.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var h=function(e,t){try{var n=function(){var e={};if(r.forEach(function(t,n){var r=t.Column.toLowerCase();t.name=r,t.Label=null==t.Label||0===t.Label.length?t.Column:t.Label,null==t.Type&&(t.Type=null==t.type?"double":t.type),t.custom=!1,e[r]=t}),null!=s)for(var t in s){var n=a({},s[t]);n.name=t,n.custom=!0,e[t]=n}return{columns:e,data:c,status:i}},r=e.schema,o=e.rows,s=t.appControl.customColumns,i={statusCode:0,msg:"Initialization was successful"},c=[],l=(f=o,h=function(e){var n=function(e,t,n){var r={_rowIndex:n};if(t.forEach(function(t,n){var o=e[n].Column.toLowerCase();r[o]=t}),null!=s)for(var o in s){var a=s[o],u=a.Column.toLowerCase();r[u]=a.value}return r}(r,o[e],e);return Promise.resolve(u("init",n,e,t)).then(function(e){i=e[1],c.push(e[0])})},P=-1,function e(t){try{for(;++P<f.length;)if((t=h(P))&&t.then){if(!((n=t)instanceof v&&1&n.s))return void t.then(e,p||(p=m.bind(null,d=new v,2)));t=t.v}d?m(d,1,t):d=t}catch(e){m(d||(d=new v),2,e)}var n}(),d);return Promise.resolve(l&&l.then?l.then(n):n())}catch(e){return Promise.reject(e)}var f,h,d,p,P};const v=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){const r=new e,o=this.s;if(o){const e=1&o?t:n;if(e){try{m(r,1,e(this.v))}catch(e){m(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?m(r,1,t?t(o):o):n?m(r,1,n(o)):m(r,2,o)}catch(e){m(r,2,e)}},r},e}();e.cellEdit=function(e,t,n,r,o){try{var s,i=function(e){return s?e:Promise.resolve(u("main",c,n,o)).then(function(e){var t;function s(n){return t?n:(c=e[0],!0===o.appControl.cachePolicy&&(o.state.data[r._rowIndex]=c),{data:c,status:v})}var a=function(){if(!0===h)return Promise.resolve(u("term",e[0],n,o)).then(function(n){return 2===(v=(e=n)[1]).statusCode?(t=1,{data:e[0],status:v}):Promise.resolve(f(e[0],o)).then(function(e){v=e})})}();return a&&a.then?a.then(s):s(a)})},c=a({},r),l=o.appControl.editControl,m=l.handlers,h=l.autoSave;c[e]=function(e,t){var n=e,r=t.Type.toLowerCase();return"string"!=typeof n||"decimal"!==r&&"number"!==r&&"double"!==r&&"float"!==r||(n=parseFloat(1*e),!0===isNaN(e)&&(e=0)),n}(t,o.state.columns[e]);var v={statusCode:0,msg:""},d=function(){if(null!=m[e])return Promise.resolve(m[e](c,e,n,o)).then(function(e){if(c=e[0],2===(v=e[1]).statusCode)return s=1,{data:e[0],status:v}})}();return Promise.resolve(d&&d.then?d.then(i):i(d))}catch(e){return Promise.reject(e)}},e.commonHandler=u,e.distinctValues=function(e,n,r,o){try{var s,a="cas"===r.source?Promise.resolve(function(e,n,r,o){try{return Promise.resolve(t.caslRun(r.store,r.session,"\n  results = selectionLists(_args_.column,_args_.table.caslib, _args_.table.name);\n  send_response({casResults = {data=results}});\n  ",{table:e,column:n},!0)).then(function(e){if(0!==e.results.casResults.data.statusCode)throw"Failed to create unique list";return e.results.casResults.data.data})}catch(e){return Promise.reject(e)}}(e,n,r)).then(function(e){s=e}):Promise.resolve(function(e,t,n){try{var r={};return r[e]=[],Promise.resolve(r)}catch(e){return Promise.reject(e)}}(e)).then(function(e){s=e});return Promise.resolve(a&&a.then?a.then(function(){return s}):s)}catch(e){return Promise.reject(e)}},e.fetchTableRows=function(e,n){try{var r=null,o="cas"===n.source?Promise.resolve(function(e,n){try{var r=n.store,o=n.session,s=a({},e);return s.from<=0||-1===s.next?Promise.resolve(null):(null==s.where&&(s.where=" "),Promise.resolve(t.casFetchRows(r,o,s)).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(h(e.data,n)).then(function(r){t=r,n.state={modified:[],pagination:a({},e.pagination),currentPage:s,data:[],columns:[]},!0===n.appControl.cachePolicy&&(n.state.data=t.data,n.state.columns=t.columns),t.pagination=a({},e.pagination)})}();return r&&r.then?r.then(function(){return t}):t}))}catch(e){return Promise.reject(e)}}(e,n)).then(function(e){r=e}):Promise.resolve(function(e,n){try{var r=n.store,o=n.tableSummary,s=n.appControl.table,a=(s.libref+"."+s.name).toLowerCase();return Promise.resolve(t.computeFetchData(r,o,a,null,{qs:{start:e.from-1,limit:e.count,format:null==e.format&&e.format}})).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(h(e,n)).then(function(e){n.state={modified:[],pagination:{},currentPage:{},data:(t=e).data,columns:t.columns}})}();return r&&r.then?r.then(function(){return t}):t})}catch(e){return Promise.reject(e)}}(e,n)).then(function(e){r=e});return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},e.saveTable=function(e,n){try{var r=e.store,o=e.session;return"compute"===e.source?Promise.resolve({msg:"Action does not apply to SAS 9 tables",statusCode:0}):Promise.resolve(t.casSaveTable(r,o,null!=n?n:e.appControl.table)).then(function(){return{msg:"Table saved",statusCode:0}})}catch(e){return Promise.reject(e)}},e.scrollTable=function(e,n,r){try{var o,s="cas"===n.source?Promise.resolve(function(e,n,r){try{var o,s=n.store,u=n.session,i=n.appControl,c=i.table;if("first"===e)o=a({},i.initialFetch);else if(null!==e&&(-1===(o=a({},n.state.pagination[e])).next||o.from<=0))return Promise.resolve(null);return null!=r&&(o=a({},r)),o.table=c,Promise.resolve(t.casFetchRows(s,u,o)).then(function(e){var t=null;return function(){if(null!==e)return Promise.resolve(h(e.data,n)).then(function(r){return t=r,n.state={modified:[],pagination:a({},e.pagination),currentPage:o,data:[],columns:[]},!0===n.appControl.cachePolicy&&(n.state.data=t.data,n.state.columns=t.columns),t.pagination=a({},e.pagination),t})}()})}catch(e){return Promise.reject(e)}}(e,n,r)).then(function(e){o=e}):Promise.resolve(function(e,n,r){try{var o=n.store,s=n.tableSummary,u=n.appControl,i=u.table,c=u.initialFetch,l=null,f=(i.libref+"."+i.name).toLowerCase();return null==r?"first"===e&&(l=a({},c)):l=a({},r),Promise.resolve(t.computeFetchData(o,s,f,e,l)).then(function(e){var t=null,r=function(){if(null!==e)return Promise.resolve(h(e,n)).then(function(e){n.state={modified:[],pagination:{},currentPage:{},data:(t=e).data,columns:t.columns}})}();return r&&r.then?r.then(function(){return t}):t})}catch(e){return Promise.reject(e)}}(e,n,r)).then(function(e){o=e});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(e){return Promise.reject(e)}},e.setup=function(e,r,o){try{var a,u=n.initStore();null==e.authType&&(e.authType="code");var i="cas"===r.source?Promise.resolve(function(e,n,r,o){try{return Promise.resolve(t.casSetup(e,n)).then(function(t){return{source:r.source,store:e,session:t.session,servers:t.servers,restaflib:null,logonPayload:n,appControl:s.default(r),state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})}catch(e){return Promise.reject(e)}}(u,e,r)).then(function(e){a=e}):Promise.resolve(function(e,n,r,o){try{return Promise.resolve(t.computeSetup(e,r.computeContext,n)).then(function(a){return Promise.resolve(t.computeSetupTables(e,a,r.table,o)).then(function(t){return{source:r.source,store:e,session:a,tableSummary:t,servers:null,restaflib:null,logonPayload:n,appControl:s.default(r),state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}},id:Date()}})})}catch(e){return Promise.reject(e)}}(u,e,r,o)).then(function(e){a=e});return Promise.resolve(i&&i.then?i.then(function(){return a}):a)}catch(e){return Promise.reject(e)}},e.updateTableRows=f,e.uploadData=function(e,n,r,o,s,u,i){try{var c=s.store,l=s.session,f=Object.keys(n[0]),m=["_index_","_rowIndex"];null!==r&&(m=m.concat(r));var h=f.filter(function(e){return!(m.indexOf(e)>=0)}),v={};h.forEach(function(e){v[e]=s.state.columns[e]});var d=null;"cas"===s.source&&(d=h.join(",")+"\n");for(var p,P=function(e){var t=n[e];t=a({},t,o);var r=[];h.forEach(function(e,n){var o=t[e];"string"==typeof o&&(o=o.trim()),r[n]=o}),d=null===d?r.join(",")+"\n":d+r.join(",")+"\n"},y=0;y<n.length;y++)P(y);var b="cas"===s.source?Promise.resolve(function(e,n,r,o,s,a){try{return Promise.resolve(t.casUpload(e,n,null,r.caslib+"."+r.name,!0,o)).then(function(o){return null!=s?Promise.resolve(t.casAppendTable(e,n,r,s,a)).then(function(e){return o=e}):o})}catch(e){return Promise.reject(e)}}(c,l,e,d,u,i)).then(function(e){p=e}):Promise.resolve(function(e,n,r,o,s){try{var a="data "+o.libref+"."+o.name+"; INFILE datalines delimiter=',' ;\n",u="",i="INPUT ";for(var c in r){var l=r[c];i=i+l.Column+" ","CHAR"===l.Type&&(u=u+"  "+l.Column+" $ "+l.length+" \n")}return u.length>0&&(u="LENGTH "+u+";\n"),a=a+";\n"+u+(i+=";\n")+"datalines;\n"+s+"\n; run; proc print;run;\n",Promise.resolve(t.computeRun(e,n,a)).then(function(){return{msg:"done",statusCode:0}})}catch(e){return Promise.reject(e)}}(c,l,v,e,d)).then(function(e){p=e});return Promise.resolve(b&&b.then?b.then(function(){return p}):p)}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=index.umd.js.map
