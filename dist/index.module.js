import{casUpdateData as t,casFetchRows as e,computeFetchData as r,casSetup as n,computeSetup as o,computeSetupTables as a}from"@sassoftware/restaflib";import{initStore as s}from"@sassoftware/restaf";function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i.apply(this,arguments)}var u=function(t,e,r,n){try{var o=n.appControl.editControl.handlers;return null==o[t]?Promise.resolve([e,{statusCode:0,msg:null}]):Promise.resolve(o[t](e,r,n,t)).then(function(t){return[t[0],t[1]]})}catch(t){return Promise.reject(t)}},l=function(e,r){try{var n,o="cas"===r.source?Promise.resolve(function(e,r){try{var n=r.store,o=r.session,a=r.appControl.dataControl,s=a.table,i=a.byvars,u=r.state.columns,l={};if(null===i||0===i.length)return Promise.resolve(null);for(var c in e)"_index_"!==c&&!1===u[c].custom&&(l[c]=e[c]);var f={};return i.forEach(function(t){f[t]=l[t]}),Promise.resolve(t(n,o,{table:s,data:l,where:f}))}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){n=t}):Promise.resolve(function(t,e){try{var r=e.store,n=e.session,o=e.appControl.dataControl,a=o.table,s=o.byvars;if(null===s||0===s.length)return Promise.resolve(null);var i="proc sql; update "+a.libref+"."+a.name+";",u="set ",l=" ";for(var f in t)u=u+l+f+"="+c(t[f]),l=", ";var m="where  ",v=" ";s.forEach(function(e){m=m+v+e+"="+c(t[e]),v="AND "});var h=(i=i+" "+m+";run;").split(/\r?\n/);console.log(h);var d={data:{code:h}};return Promise.resolve(r.apiCall(n.links("execute"),d)).then(function(t){return Promise.resolve(r.jobState(t,{qs:{newState:"Completed",timeout:1}})).then(function(t){return console.log(t.data),!0})})}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){n=t});return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(t){return Promise.reject(t)}};function c(t){return null==t?".":"string"==typeof t?JSON.stringify(t):t.toString()}var f=function(t,e,r,n,o){try{var a,s=function(t){return a?t:Promise.resolve(u("main",c,r,o)).then(function(t){var e;function n(n){return e?n:(c=t[0],h.msg=h.msg+" / "+t[1],!0===o.appControl.dataControl.cachePolicy&&(o.state.data[r]=c),{data:c,status:h})}var a=function(){if(!0===v)return Promise.resolve(u("term",t[0],r,o)).then(function(r){return 2===(h=(t=r)[1]).statusCode?(e=1,{data:t[0],status:h}):Promise.resolve(l(c,o)).then(function(){})})}();return a&&a.then?a.then(n):n(a)})},c=i({},null!==n?n:o.state.data[r]),f=o.appControl.editControl,m=f.handlers,v=f.autoSave;c[t]=function(t,e){var r=t;return"string"!=typeof r||"decimal"!==e.Type&&"number"!==e.Type&&"double"!==e.Type||(r=parseFloat(1*t),!0===isNaN(t)&&(t=0)),r}(e,o.state.columns[t]);var h={statusCode:0,msg:""},d=function(){if(null!=m[t])return Promise.resolve(m[t](c,t,r,o)).then(function(t){if(c=t[0],2===(h=t[1]).statusCode)return a=1,{data:t[0],status:h}})}();return Promise.resolve(d&&d.then?d.then(s):s(d))}catch(t){return Promise.reject(t)}};function m(t,e,r){if(!t.s){if(r instanceof h){if(!r.s)return void(r.o=m.bind(null,t,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(m.bind(null,t,e),m.bind(null,t,2));t.s=e,t.v=r;var n=t.o;n&&n(t)}}var v=function(t,e){try{var r=function(){var t={};if(n.forEach(function(e,r){var n=e.Column.toLowerCase();e.name=n,e.Label=null==e.Label||0===e.Label.length?e.Column:e.Label,e.custom=!1,t[n]=e}),null!=a)for(var e in a){var r=i({},a[e]);r.name=e,r.custom=!0,t[e]=r}return{columns:t,data:s}},n=t.schema,o=t.rows,a=e.appControl.dataControl.customColumns,s=[],l=(c=o,f=function(t){var r=function(t,e){var r={};if(e.forEach(function(e,n){var o=t[n],a=o.Column.toLowerCase();null==o.Label&&(o.Label=o.Column),r[a]=e}),null!=a)for(var n in a){var o=a[n],s=o.Column.toLowerCase();r[s]=o.value}return r}(n,o[t]);return Promise.resolve(u("init",r,t,e)).then(function(t){var e=t[0],r=t[1];0!==r.code&&console.log(JSON.stringify(r,null,4)),s.push(e)})},p=-1,function t(e){try{for(;++p<c.length;)if((e=f(p))&&e.then){if(!((r=e)instanceof h&&1&r.s))return void e.then(t,d||(d=m.bind(null,v=new h,2)));e=e.v}v?m(v,1,e):v=e}catch(t){m(v||(v=new h),2,t)}var r}(),v);return Promise.resolve(l&&l.then?l.then(r):r())}catch(t){return Promise.reject(t)}var c,f,v,d,p};const h=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,r){const n=new t,o=this.s;if(o){const t=1&o?e:r;if(t){try{m(n,1,t(this.v))}catch(t){m(n,2,t)}return n}return this}return this.o=function(t){try{const o=t.v;1&t.s?m(n,1,e?e(o):o):r?m(n,1,r(o)):m(n,2,o)}catch(t){m(n,2,t)}},n},t}();var d=function(t,r){try{var n=r.store,o=r.session,a=i({},t);return null==a.table&&(a.table=r.appControl.dataControl.table),null==a.where&&(a.where={}),a.from<=0||-1===a.next?Promise.resolve(null):Promise.resolve(e(n,o,a)).then(function(t){return Promise.resolve(v(t.data,r)).then(function(e){return r.state={modified:[],pagination:i({},t.pagination),currentPage:a,data:[],columns:[]},!0===r.appControl.dataControl.cachePolicy&&(r.state.data=e.data,r.state.columns=e.columns),e.pagination=i({},t.pagination),e})})}catch(t){return Promise.reject(t)}},p=function(t,e){try{var n,o="cas"===e.source?Promise.resolve(function(t,e){try{var r,n=e.appControl.dataControl,o=n.table;if("first"===t)(r=i({},n.initialFetch)).table=o;else if(-1===(r=e.state.pagination[t]).next)return Promise.resolve(null);return Promise.resolve(d(r,e))}catch(t){return Promise.reject(t)}}(t,e)).then(function(t){n=t}):Promise.resolve(function(t,e){try{var n=e.store,o=e.tableSummary,a=e.appControl.dataControl.table,s=(a.libref+"."+a.name).toLowerCase();return Promise.resolve(r(n,o,s,t,{limit:e.appControl.dataControl.initialFetch.count})).then(function(t){return console.log(t),Promise.resolve(v(t,e)).then(function(t){return e.state={modified:[],pagination:{},currentPage:{},data:t.data,columns:t.columns},t})})}catch(t){return Promise.reject(t)}}(t,e)).then(function(t){n=t});return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(t){return Promise.reject(t)}},P=function(t,e){try{var r,i=function(){return r.appControl=e,r.id=Date(),r},u=s();null==t.authType&&(t.authType="code");var l=e.dataControl,c="cas"===l.source?Promise.resolve(n(u,t)).then(function(e){r={source:l.source,store:u,session:e.session,servers:e.servers,restaflib:null,logonPayload:t,state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}}}}):Promise.resolve(o(u,null,t)).then(function(e){return Promise.resolve(a(u,e,l.table)).then(function(n){r={store:u,session:e,tableSummary:n,servers:null,restaflib:null,logonPayload:t,state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}}}})});return Promise.resolve(c&&c.then?c.then(i):i())}catch(t){return Promise.reject(t)}};export{f as cellEdit,u as commonHandler,d as fetchTableRows,p as scrollTable,P as setup,l as updateTableRows};
//# sourceMappingURL=index.module.js.map
