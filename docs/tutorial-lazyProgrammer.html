<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Library Overviews lazyProgrammer</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Overviews</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-authentication.html">
                                authentication
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Browsing-a-Cas-Table.html">
                                Browsing-a-Cas-Table
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-casActionRun.html">
                                casActionRun
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-casActionRunExample.html">
                                casActionRunExample
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-casFetchData.html">
                                casFetchData
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-caslScore.html">
                                caslScore
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Compute-Service-made-easy.html">
                                Compute-Service-made-easy
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-computeResults.html">
                                computeResults
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-computeRun.html">
                                computeRun
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-computeRunExample.html">
                                computeRunExample
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-computeSetup.html">
                                computeSetup
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-computeSummary.html">
                                computeSummary
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Configuring-SAS-Viya-AWS-Quick-Start-for-serverless-functions.html">
                                Configuring-SAS-Viya-AWS-Quick-Start-for-serverless-functions
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Executing-a-cas-action.html">
                                Executing-a-cas-action
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-findReport.html">
                                findReport
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-getReportImage.html">
                                getReportImage
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-getReportUri.html">
                                getReportUri
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-lazyProgrammer.html">
                                lazyProgrammer
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Managing-clientids.html">
                                Managing-clientids
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-masDescribe.html">
                                masDescribe
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-restafeditExample.html">
                                restafeditExample
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Scoring-in-the-Cas-Server.html">
                                Scoring-in-the-Cas-Server
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Scoring-with-MAS.html">
                                Scoring-with-MAS
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Scripting-on-the-Cas-Server.html">
                                Scripting-on-the-Cas-Server
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-usefulTips.html">
                                usefulTips
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-vaddc.html">
                                vaddc
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/sassoftware/restaf/blob/main/README.md"
                        >
                            restaf
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/sassoftware/restaf/blob/main/packages/restaflib/README.md"
                        >
                            restaflib
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/sassoftware/restaf/blob/restafedit/README.md"
                        >
                            restafedit
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar tutorials"
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-authentication.html">authentication</a></li><li><a href="tutorial-Browsing-a-Cas-Table.html">Browsing-a-Cas-Table</a></li><li><a href="tutorial-casActionRun.html">casActionRun</a></li><li><a href="tutorial-casActionRunExample.html">casActionRunExample</a></li><li><a href="tutorial-casFetchData.html">casFetchData</a></li><li><a href="tutorial-caslScore.html">caslScore</a></li><li><a href="tutorial-Compute-Service-made-easy.html">Compute-Service-made-easy</a></li><li><a href="tutorial-computeResults.html">computeResults</a></li><li><a href="tutorial-computeRun.html">computeRun</a></li><li><a href="tutorial-computeRunExample.html">computeRunExample</a></li><li><a href="tutorial-computeSetup.html">computeSetup</a></li><li><a href="tutorial-computeSummary.html">computeSummary</a></li><li><a href="tutorial-Configuring-SAS-Viya-AWS-Quick-Start-for-serverless-functions.html">Configuring-SAS-Viya-AWS-Quick-Start-for-serverless-functions</a></li><li><a href="tutorial-Executing-a-cas-action.html">Executing-a-cas-action</a></li><li><a href="tutorial-findReport.html">findReport</a></li><li><a href="tutorial-getReportImage.html">getReportImage</a></li><li><a href="tutorial-getReportUri.html">getReportUri</a></li><li><a href="tutorial-lazyProgrammer.html">lazyProgrammer</a></li><li><a href="tutorial-Managing-clientids.html">Managing-clientids</a></li><li><a href="tutorial-masDescribe.html">masDescribe</a></li><li><a href="tutorial-restafeditExample.html">restafeditExample</a></li><li><a href="tutorial-Scoring-in-the-Cas-Server.html">Scoring-in-the-Cas-Server</a></li><li><a href="tutorial-Scoring-with-MAS.html">Scoring-with-MAS</a></li><li><a href="tutorial-Scripting-on-the-Cas-Server.html">Scripting-on-the-Cas-Server</a></li><li><a href="tutorial-usefulTips.html">usefulTips</a></li><li><a href="tutorial-vaddc.html">vaddc</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Tutorial</p>
                    <h1>lazyProgrammer</h1>
                </header>
                <section>

<article>
    <h1>Lazy Programmer's Guide to Developing SAS Viya Applications</h1>
<p>Philipp Lenssen writes in an <a href="http://blogoscoped.com/archive/2005-08-24-n14.html">article</a> titled &quot;Why Good Programmers Are Lazy and Dumb&quot;</p>
<p><em>Lazy because only lazy programmers will want to write the kind of
tools that might replace them in the end. Lazy, because only a lazy
programmer will avoid writing monotonous, repetitive code -- thus
avoiding redundancy, the enemy of software maintenance and flexible
refactoring. Mostly, the tools and processes that come out of this
endeavor fired by laziness will speed up the production. This makes a lazy programmer a smart and efficient programmer.</em></p>
<p><strong>From a SAS Viya Application developer's perspective</strong></p>
<p>One of the great strengths of SAS Viya is the large collection of REST
APIs that allow customers to integrate SAS Viya capabilities into their
applications. Using these APIs, the user's applications access the full
complement of SAS Viya capabilities - data preparation, analysis and
reporting.</p>
<p>Just about every SAS Viya application will call a few key services to do
the heavy lifting on the Viya server. The figure below shows these
typical patterns.</p>
<p><img src="https://github.com/sassoftware/restaf/blob/2.0.0/images/CommonScenarios.png" alt="Common Scenarios"></p>
<p>How many times does one have to write the same code to call different
REST APIs when those are all similar, but for the payload? How many
times does one to have to write code to &quot;reduce&quot; the JSON response to be
useful in presentations?</p>
<p>You too can become a <strong>smart lazy programmer</strong> by using the techniques discussed in this article. Spend less time writing code that writes itself, spend more time solving real business problems and use the extra time doing things you always wanted to do.</p>
<h2>Tools for lazy programmer</h2>
<p>Keeping with the lazy programmer point of view I have developed two
JavaScript libraries to take care of the tedious part of application
development.</p>
<ol>
<li>
<p><a href="https://github.com/sassoftware/restaf/wiki">restaf</a>
is a lightweight, UI-framework agnostic, JavaScript library designed
to be easy-to-use for app developers. restaf takes advantage of the
consistency of the REST APIs to reduce the responses from the server
into a standard form, and it also manages the data on the client
side. This reduction enables developers to interact with the server
in a repeating pattern regardless of which service the application
is using.</p>
</li>
<li>
<p><a href="https://github.com/sassoftware/restaf/wiki/restaflib-introduction">restaflib</a> is a helper library built on top of restaf to simplify the common patterns described above.</p>
</li>
</ol>
<p>&nbsp;</p>
Code developed with these libraries run in a browser or a nodejs
application. All the examples shown in this article run in either
scenario.
<h2>Using the libraries</h2>
<h3>Web Applications</h3>
<p>Include the following two script tags.</p>
<pre class="prettyprint source lang-html"><code>
&lt;script src=&quot;https://unpkg.com/@sassoftware/restaf/dist/restaf.min.js&quot;>&lt;/script>

&lt;script src=&quot;https://unpkg.com/@sassoftware/restaflib/dist/restaflib.min.js&quot;>&lt;/script>
</code></pre>
<p>Two globals restaf and restaflib will be available for use in your
script tags.</p>
<h3>Node.js application</h3>
<p>Install restaf and restaflib using the following command</p>
<pre class="prettyprint source lang-sh"><code>npm install @sassoftware/restaf @sassoftware/restaflib
</code></pre>
<h3>Program initialization</h3>
<p>A typical initialization code(for both web and nodejs applications) will
look like this:</p>
<pre class="prettyprint source lang-js"><code>  let store = restaf.initStore();
  store.logon(logonPayload)
    .then (() =&lt; {
        ...your code...
    })
    .catch(err => {
        ...handle errors...
    })
</code></pre>
<p>Please refer to the <a href="https://github.com/sassoftware/restaf/wiki/authentication">authentication page of the restaf
repository</a>
for details on how the logon method works.</p>
<h2>Contents</h2>
<p>For fast access to specific sections use these links</p>
<ul>
<li><a href="#run-traditional-sas-programs-on-server">SAS Programs</a></li>
<li><a href="#run-cas-action">Run Cas Action</a></li>
<li><a href="#upload-data-to-cas">Upload Data to CAS</a></li>
<li><a href="#run-casl-script-on-server">Run CASL Script on Server</a></li>
<li><a href="#score-with-mas">Score with MAS</a></li>
<li><a href="#score-with-cas">Score with CAS</a></li>
<li><a href="#scoring-with-cas-actions">Scoring with CAS actions</a></li>
<li><a href="#embed-va-reports">Embed VA reports</a></li>
<li><a href="#other-common-scenarios">Other common scenarios</a></li>
</ul>
<p>The rest of article explains how one can program for the common scenarios shown in the figure above.</p>
<p>&nbsp;</p>
<hr>
<h2>Run Traditional SAS Programs on server</h2>
<hr>
<p>A traditional SAS program consists of PROC statements, data step, and
macros. In SAS Viya this executes using the <a href="https://developer.sas.com/apis/rest/Compute/">compute
service</a>.</p>
<p>The compute service API covers many different uses. The simplest and
most common use cases are run a SAS job and view the ODS output, log,
listing, and browse the generated tables.</p>
<h3><strong>Setup: computeSetup</strong></h3>
<p>This method creates a compute service session.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let session = await restaflib.computeSetup(store, contextName);
</code></pre>
<p>The parameters are:</p>
<ul>
<li>
<p><em>store</em> - restaf store object</p>
</li>
<li>
<p><em>contextName</em> - (optional) if not specified the first context in
the list is used</p>
</li>
</ul>
<h3><strong>Run: computeRun</strong></h3>
<p>This method executes the specified code on the server</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let computeSummary = await restaflib.computeRun(store, session, src, macros);
</code></pre>
<p>The parameters are:</p>
<ul>
<li>
<p><em>store</em> - restaf store object</p>
</li>
<li>
<p><em>session</em> - the session object obtained thru the computeSetup
method</p>
</li>
<li>
<p><em>src</em> - a string containing the source code to be executed</p>
</li>
<li>
<p><em>macros</em> - (optional) A javascript object that is sent to the
server as macros. For example, if this object is {lib: 'sasuser',
data: 'mydata'} the following macros are prepended to the source
code.</p>
<pre><code>    %let lib=sasuser;
    %let data=mydata;
</code></pre>
</li>
</ul>
<p>The result from the computeRun method is used to retrieve specific
results using the following methods.</p>
<h3><strong>Results: computeResults</strong></h3>
<p>This method retrieves the ods output, log, listing, and the list of
tables.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>        let result = await restaflib.computeResults(store, computeSummary,
type);
</code></pre>
<p>The parameters are:</p>
<ul>
<li>
<p><em>store</em> - the restaf store</p>
</li>
<li>
<p><em>computeSummary</em> - the output from restaflib.computeRun</p>
</li>
<li>
<p><em>type</em> - A string with one of the following values
ods|log|listing|tables. Based on this option different results
are returned.</p>
</li>
</ul>
<p>The results based on the value of type are:</p>
<ul>
<li>
<p><em>ods</em> - This returns a string that has the ODS output. This html
can be passed to some component for display.</p>
</li>
<li>
<p><em>log</em> - This returns all the log for this particular job. The
content is an array of objects that follows the media type for
<a href="https://developer.sas.com/apis/rest/Compute">loglines</a></p>
</li>
<li>
<p><em>listing</em> - This returns all the listings for this particular job
with the same format as the log.</p>
</li>
<li>
<p><em>tables</em> - This returns an array with the names of the tables from
the job. Use this name to retrieve the actual records using the
restaflib.computeFetchData method described below.</p>
</li>
</ul>
<h3><strong>Data: computeFetchData</strong></h3>
<p>Use this method to page thru the records of the tables returned by the
computeRun method.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let result = await restaflib.computeFetchData(store, computeSummary,
    tablename, direction);
</code></pre>
<p>The parameters are:</p>
<ul>
<li>
<p><em>store</em> -- the restaf store</p>
</li>
<li>
<p><em>computeSummary</em> - the output from restaflib.computeRun</p>
</li>
<li>
<p><em>tablename</em> - The name of the table returned (see computeResults
method above).</p>
</li>
<li>
<p><em>direction</em> - A string indicatilng which direction to scroll
(next, prev) and get records. If not specified, the first set of
records are returned. The valid values of this parameter depend on
what was returned in the scrollOptions field of the result.</p>
</li>
</ul>
<p>The result from the computeFetchData has the following schema:</p>
<pre class="prettyprint source lang-text"><code>
   { 
    rows         : An array of data rows - [{val1, val2,...}, {val1,val2,...}] ,
    columns      : The standard schema for the columns,
    scrollOptions: An array of valid scrolling directions - first,prev,next,last
   }

</code></pre>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>    async function example () {
        let computeSession = await computeSetup(store);
        /* prep input */
        let macros = {maxRows: 500};
        let src =  `ods html style=barrettsblue;
        data work.dtemp1;
            array x{10};  
            do j = 1 to &maxRows;  
            do i = 1 to 10;  
                x{i} = i * 10;  
                end;  
            output;  
            put _ALL_;  
            end;  
            run;  
            proc print;run;  
            ods html close;`;
        // Run the SAS job
        let computeSummary = await restaflib.computeRun(store, computeSession, src,  macros);

        // Get log, listing, ods and list of tables
        let log = await restaflib.computeResults(store, computeSummary, 'log');
        let list = await restaflib.computeResults(store, computeSummary, 'listing');
        let ods = await restaflib.computeResults(store, computeSummary, 'ods');
        let tables = await restaflib.computeResults(store, computeSummary, 'tables');

        // Scroll thru one of the tables
        let data = await restaflib.computeFetchData(store,computeSummary, 'DTEMP1');
        console.log(data.columns);
        console.log(data.rows);

        do {
        data = await restaflib.computeFetchData(store,computeSummary, 'DTEMP1', 'next');
        if (data !== null) {
            console.log(data.rows);
        }
        } while (data != null);

    // Delete session
        await store.apiCall(computeSession.links('delete'));
    }
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<h2>Run CAS action</h2>
<hr>
<h3><strong>Setup: casSetup</strong></h3>
<p>This method creates a CAS Session</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let {session} = await restaflib.casSetup(store);
</code></pre>
<h3><strong>Run: casActionRun</strong></h3>
<p>This method runs the specified action.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>let actionResult = await restaflib.casActionRun(store, session,
payload);
</code></pre>
<p>The arguments to this method are:</p>
<ul>
<li>
<p><em>store</em> - the store object for restaf</p>
</li>
<li>
<p><em>session</em> - the session object from the casSetup method</p>
</li>
<li>
<p><em>payload</em> - an object with the schema describe below</p>
</li>
</ul>
<p>The payload is:</p>
<pre class="prettyprint source lang-text"><code>{ 
    action : name of the action - actionset.actionname, 
    data   : parameters for the selected actio
    headers: If needed
}
</code></pre>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>async function example() {

let {session} = await restaflib.casSetup (store);

  let p = {

    action: 'builtins.echo',

    data  : {

      code: 'data casuser.score; x1=10;x2=20;x3=30; score1 = x1+x2+x3;run; '

    }

  };

  r = await restaflib.casActionRun(store, session, p);

  await store.apiCall(session.links('delete'));

  return 'done';

};
</code></pre>
<h3><strong>Processing results</strong></h3>
<p>The result of the action will vary based on the action. For more
details, refer to the <a href="https://go.documentation.sas.com/?cdcId=pgmcdc&amp;cdcVersion=8.11&amp;docsetId=allprodsactions&amp;docsetTarget=titlepage.htm&amp;locale=en">CAS Actions
documentation</a>.</p>
<h3><strong>Notes on table.upload action</strong></h3>
<p>This action requires information be passed in the header. Below is an
example for uploading a cars.csv file to casuser.cars:</p>
<pre class="prettyprint source lang-js"><code>    let JSON_Parameters = {
        casout: {
          caslib: 'casuser' /* a valid caslib */,
          name  : 'cars' /* name of output file on cas server */
        },

        importOptions: {
          fileType: 'csv' /* type of the file being uploaded */
        }
      };

      let p = {
        headers: { 'JSON-Parameters': JSON_Parameters },
        data   : readFile(filename, fileType),  /* read file from a local csv file */
        action : 'table.upload'
      };

      let actionResult = await restaflib.casActionRun(store, session, p);
      ... process results ...
</code></pre>
<p>A simpler way is to use the casUpload method, described in the next
section.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<h2>Upload Data to CAS</h2>
<hr>
<p>The casUpload method handles the common scenario of loading CSV  into
CAS for further processing.</p>
<h3><strong>Setup: casSetup</strong></h3>
<p>This method creates a CAS Session.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let {session} = await restaflib.casSetup(store);
</code></pre>
<h3><strong>Run: casUpload</strong></h3>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let r = await restaflib.casUpload(store, session, filePath, output,
    save, altSrc);
</code></pre>
<p>The parameters are:</p>
<ul>
<li>
<p><em>store</em>    -- the restaf store</p>
</li>
<li>
<p><em>session</em>  -- the current CAS session obtained via casSetup</p>
</li>
<li>
<p><em>filePath</em> -- path to the file (ex: /mydata/cars.csv)</p>
</li>
<li>
<p><em>output</em>   -- set to true if you want the data to be saved; the
default is false</p>
</li>
<li>
<p><em>altSrc</em>   -- in some applications the CSV file is generated
programmatically -- in that case pass the string here</p>
</li>
</ul>
<p>The casUpload function handles other file types also -- see
<a href="https://github.com/sassoftware/restaf/wiki/restaflib-introduction">here</a>
for more details.</p>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>    async function example(path, table) {

         let {session} = await casSetup(store);

         await restaflib.casUpload(store, session,
    './mydata/cars.csv', 'casuser.cars', true, null);

     };
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<h2>Run CASL Script on Server</h2>
<hr>
<p>A common workflow may require multiple CAS actions, in sequence, with
additional flow control. The CASL language is ideal for such scripting.
The CASL code executes using the sccasl.runCASl action. While this
action could run using the casActionRun method, the usefulness of this
approach dictates a separate method. This section shows the use of
caslRun method to run the CASL scripts on the server.</p>
<h3><strong>Run: caslRun</strong></h3>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let result = restaflib.caslRun(store, session, casl, args)
</code></pre>
<p>The arguments to this function are:</p>
<ul>
<li>
<p><em>store</em> - the restaf store</p>
</li>
<li>
<p><em>session</em> - the session obtained through casSetup</p>
</li>
<li>
<p><em>casl</em> - A string with the CASL code to execute</p>
</li>
<li>
<p><em>args</em> - The args parameter (a standard js object) is passed to
the CASL program as a CASL dictionary named _<em>args_</em>. This is a
friendly way to pass parameters to your CASL programs.</p>
</li>
</ul>
<p>The caslRun executes the sccasl.runcasl action on the CAS server. If the
status in the results is non-zero caslRun throws an error you handle in
your catch block. The key elements of the response are:</p>
<ul>
<li>
<p><em>result.log</em> - is the log lines</p>
</li>
<li>
<p><em>result.disposition</em> - the standard CAS disposition object</p>
</li>
<li>
<p><em>result.results</em> - the object passed to the send_response
function in the CASL program</p>
</li>
</ul>
<p></p>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>    async function example() {
      let {session} = await restaflib.casSetup (store);                                  
      /* Recommendation: Store the casl code in a repository */
      let casl = `                                                                       
              print 'input values';
              print _args_;
               action datastep.runcode/ single='YES' code = 'data casuser.a; x=1; run;';
               action table.fetch r=r1/
                  table= { caslib= 'casuser', name= 'a' } ;
                  run;
                  action datastep.runcode/ single='YES' code = 'data casuser.b; y=1; run;';
                action table.fetch r=r2/
                  table= { caslib= 'casuser', name= 'b' } ;
                  run;
               c = {a=10, b=20}; /* just to show that anything can be returned */
               send_response({a=r1, b=r2, c=c});
            `;
      let args   = {a: &quot;this is arguments&quot;, b: &quot;more data&quot;};

      let result = await restaflib.caslRun (store, session, casl, args);
      console.log(JSON.stringify(result, null,4));
      await store.apiCall(session.links('delete'));
     }
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<h2>Score with MAS</h2>
<hr>
<p>The Micro Analytic Score (MAS) service runs real-time scoring for many
models and a large number of users. The models to be scored are
published to the server.</p>
<h3><strong>Setup: masSetup</strong></h3>
<p>This method sets up the necessary information to score with MAS.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>        let masControl = await restaflib.masSetup(store, models);
</code></pre>
<p>The arguments to this method are:</p>
<ul>
<li>
<p><em>store</em> - restaf store</p>
</li>
<li>
<p><em>models</em> - an array of model names you want to use for scoring</p>
</li>
</ul>
<h3><strong>Describe: masDescribe</strong></h3>
<p>Use this method to get information on the input to the scoring model.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let input = masDescribe(masControl, modelName, step);
</code></pre>
<p>The parameters to this method are:</p>
<ul>
<li>
<p><em>masControl</em> - the object returned from masSetup</p>
</li>
<li>
<p><em>modelName</em> -- the name of the model</p>
</li>
<li>
<p><em>step</em> - the step you are interested in (defaults to score)</p>
</li>
</ul>
<h3><strong>Run: masRun</strong></h3>
<p>This is the method you will call to score each scenario</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let result = await restaflib.masRun(store, masControl,
    modelName,scenario, step);
</code></pre>
<p>The parameters to this method are:</p>
<ul>
<li>
<p><em>store</em> -- the restaf store</p>
</li>
<li>
<p><em>masControl</em> - the object from casSetup</p>
</li>
<li>
<p><em>modelName</em> - the name of the model to use for scoring; has to
have been specified in the models array to casSetup</p>
</li>
<li>
<p><em>scenario</em> - a JS object with the input values (see example below)</p>
</li>
<li>
<p><em>step</em> -- (optional) If not specified, the first 'score' in the
model will be used for scoring.</p>
</li>
</ul>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>
async function example () {
  let models = ['sdktgo_iris`];`
  let masControl = await restaflib.masSetup(store, models);

  let scenario = {
     petallengthcm: 1.5,
     petalwidthcm : 0.2,
     sepallengthcm: 5,
     sepalwidthcm : 3
   };
  let result = await ``restaflib.masRun`` (store, ``masControl``, models[0], scenario);
  console.log(result);
};

The sample output is shown below

A sample result is:

{ 
  I_Species``               : 'Iris-setosa',
  P_SpeciesIris_setosa      : 1,
  P_SpeciesIris_versicolor  : 0,
  P_SpeciesIris_virginica   : 0,
  _leaf_id_                 : 2 }

</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<h2>Score with CAS</h2>
<hr>
<p>Models can be published to different destinations. MAS is one of the
destinations. The CAS server is also a valid destination.</p>
<p>The caslScore method is used to score models published to a CAS
destination.</p>
<h3><strong>Run: caslScore</strong></h3>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let r = await restaflib.caslScore(store, session, scenario);
</code></pre>
<p>The three arguments to this method are:</p>
<ul>
<li>
<p><em>store</em> - the restaf store</p>
</li>
<li>
<p><em>session</em> - the CAS session object obtained via casSetup</p>
</li>
<li>
<p><em>payload</em> - Information for scoring. See the description below.</p>
</li>
</ul>
<p>The payload (see example below) has the following data:</p>
<ul>
<li>
<p>the name of the model</p>
</li>
<li>
<p>the Caslib and name of where the model is stored (a sashdat)</p>
</li>
<li>
<p>the scenario for scoring</p>
</li>
</ul>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>
 	async function example() {
        let {session} = await restaflib.casSetup(store);

        let scenario = {
            modelName: 'Gradient_Boosting_7adb0404_85e3_474d_9d03_1059ef7ae008',
            model    : { caslib: 'public', name: 'testpublish' },
            scenario : {
                sensor_ratio       : 4.3,
                days_out_of_service: 5
            }
        };
        let r = await restaflib.caslScore(store, session, scenario);
        console.log(JSON.stringify(r, null,4));
        }
The result is a Javascript object with the data returned from scoring. In the example above the result is:
{
    &quot;days_out_of_service&quot;: 5,
    &quot;sensor_ratio&quot;: 4.3,
    &quot;_Index_&quot;: 1,
    &quot;EM_EVENTPROBABILITY&quot;: 0.10521221221641,
    &quot;I_FAILURE&quot;: &quot;           0&quot;,
    &quot;P_FAILURE0&quot;: 0.89478778778358,
    &quot;P_FAILURE1&quot;: 0.10521221221641,
    &quot;_WARN_&quot;: &quot;&quot;,
    &quot;EM_CLASSIFICATION&quot;: &quot;           0&quot;,
    &quot;EM_PROBABILITY&quot;: 0.89478778778358
}


</code></pre>
<p>&nbsp;</p>
<hr>
<h2>Scoring with CAS Actions</h2>
<hr>
<p>In some scenarios, the models have been imported into a CAS server. The
form of the models could be one of these:</p>
<ol>
<li>
<p>Astore objects</p>
</li>
<li>
<p>Data step code for scoring</p>
</li>
<li>
<p>DS2 code for scoring</p>
</li>
</ol>
<p>Use the caslScore method discussed earlier for scoring but with a
different payload -- mainly not specifying the modelName</p>
<p><em>The method will decide the correct action based on the content of the
model.</em></p>
<h3><strong>Run: caslScore</strong></h3>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let r = await restaflib.caslScore(store, session, scenario);
</code></pre>
<p>The three arguments to this method are:</p>
<ul>
<li>
<p><em>store</em> - the restaf store</p>
</li>
<li>
<p><em>session</em> - the CAS session object obtained via casSetup</p>
</li>
<li>
<p><em>payload</em> - Information for scoring. See the description below.</p>
</li>
</ul>
<p>The payload (see example below) has the following data:</p>
<ul>
<li>
<p>The Caslib and name of where the model is stored (a sashdat)</p>
</li>
<li>
<p>The scenario for scoring</p>
</li>
</ul>
<h3><strong>Example</strong></h3>
<pre class="prettyprint source lang-js"><code>async function example() {
	let scenario = {
		model   : { caslib: 'casuser', name: 'gradient_boosting___bad_2jest' },
		scenario: {
			LOAN   : 100000,
			VALUE  : 10000,
			JOB    : 'J1',
			CLAGE  : 100,
			CLNO   : 20,
			DEBTINC: 20,
			DELINQ : 2,
			DEROG  : 0,
			MORTDUE: 4000,
			NINQ   : 1,
			YOJ    : 10
		}
	};

	r = await caslScore(store, session, scenario);
	return r;
};
</code></pre>
<p>&nbsp;</p>
<hr>
<h2>Embed VA reports</h2>
<hr>
<p>A very common scenario is embedding SAS Visual Analytics reports in web
applications.</p>
<p>The HTML tag for embedding the report looks like this:</p>
<pre class="prettyprint source lang-html"><code>&lt;sas-report url=your-viya-server reportUri=uri-to-the report
authenticationType=&quot;credentials&quot;>&lt;/sas-report>
</code></pre>
<p>To use this tag one needs the URI for the report. The following methods
helps you get this information.</p>
<h3><strong>setup: addServices</strong></h3>
<p>Initialize access to the reports service. *Note, this is a method on the
store.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>    let {reports} = await store.addServices('reports');
</code></pre>
<h3><strong>Run: getReportUri</strong></h3>
<p>This method returns the URI for the selected report.</p>
<p><em>Syntax</em></p>
<pre class="prettyprint source lang-js"><code>     let reportList = restaflib.getReportUri(store, name-of-your-report);
</code></pre>
<p>returns an array of the form [name-of-your-report,
uri-for-that-report]</p>
<h3><strong>Example</strong></h3>
<p>Here is a sample code to set the properties for a sas-report tag with the uri  of the report.</p>
<pre class="prettyprint source lang-js"><code>    objectElement =  document.getElementById('report0');

    objectElement.authenticationType =&quot;credentials&quot;;
    objectElement.url                = host;/* the url for the Viya server*/
    objectElement.reportUri          = reportsList[0].uri;
</code></pre>
<p>&nbsp;</p>
<hr>
<h2>Other common scenarios</h2>
<hr>
<h3><strong>Listing items</strong></h3>
<p>In many applications there is a need to list items(resources) like
these: List of files, List of MAS models, List of VA reports etc...
Below is an example for listing all the VA reports. Replace all
references of &quot;reports&quot; to your favorite service(files, folders etc...)</p>
<pre class="prettyprint source lang-js"><code>async function listReports(store) {

  //connect to reports microservice and get root links

  let { reports } = await store.addServices('reports');

  //get the first list of reports

  let result= await store.apiCall(reports.links('reports'));

  console.log(JSON.stringify(result.itemsList(), null,4));

  // get the rest of the reports

  let next;

  // do this loop while the service returns the next link

  while ((next = result.scrollCmds('next')) !== null) {

    result = await store.apiCall(next);

  console.log(JSON.stringify(result.itemsList(), null,4));

  }

  return 'done';

};
</code></pre>
<p>&nbsp;</p>
<hr>
<h2>Finally</h2>
<hr>
<p>SAS Viya REST APIs allow developers to do a lot more than what was
discussed in this article. Users can use restaf and more wrapper
libraries like restaflib to build full applications. These libraries are
available as open source at
<a href="https://github.com/sassoftware">https://github.com/sassoftware</a></p>
<p>Please feel free to clone these and modify them as you see fit.</p>
<p>&nbsp;</p>
<hr>
<h2>Links to other examples</h2>
<hr>
<p>These are links to some  examples that might be useful for learning
purposes:</p>
<ol>
<li>
<p>Web application demos
<a href="https://github.com/sassoftware/restaf-uidemos/tree/master/public">https://github.com/sassoftware/restaf-uidemos/tree/master/public</a></p>
</li>
<li>
<p>nodejs demos -
[https://github.com/sassoftware/restaf/tree/2.0.0/packages/examples/testFunctions](https://github.com/sassoftware/restaf/tree/2.0.0/packages/ s/testFunctions)</p>
</li>
<li>
<p>AWS serverless function -
<a href="https://github.com/sassoftware/restaf/tree/2.0.0/packages/serverless-score/src">https://github.com/sassoftware/restaf/tree/2.0.0/packages/serverless-score/src</a></p>
</li>
<li>
<p>Optimization application -
<a href="https://github.com/sassoftware/restaf/tree/2.0.0/packages/serverless-score/src">https://github.com/sassoftware/restaf/tree/2.0.0/packages/serverless-score/src</a></p>
</li>
</ol>
</article>

</section>

            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>