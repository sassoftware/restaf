<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: uploadSetup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: uploadSetup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Copyright Â© 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * parse a source file name
 * @module uploadSetup
 * @param {string} source - the source file( absolute or relative path can be used)
 * @returns {object} - returns {ext: file-extension, fileOptions: &lt;option for fread>, transform: transform for content-type, contentType: content-type}
 * @alias module: uploadSetup
 * @example
 *    let t = uploadSetup('./cars.sashdat');
 */

import { uploadSrc, uploadAstore } from './uploadHandlers';

function uploadSetup (source, output) {
	let fileOptions = null; /* option for file reader */
	let contentType =
		'binary/octet-stream'; /* header content-type on API call */

	let fileType; /* fileType for use in API call */
	let handler = uploadSrc;
	let transform = noChange;

	let fext = source
		.split('.')
		.pop()
		.toLowerCase();
	switch (fext) {
		case 'sas7bdat': {
			fileType = 'basesas';
			break;
		}
		case 'sashdat': {
			fileType = 'hdat';
			break;
		}

		case 'csv': {
			fileType = fext;
			fileOptions = 'UTF8';
			break;
		}

		case 'xslx':
		case 'xsl': {
			fileType = fext;
			break;
		}

		case 'astore':
		case 'sasast': {
			fileType = fext;
			handler = uploadAstore;
			transform = toBase64;
			break;
		}

		case 'ds2':
		case 'sas': {
			fileType = 'csv';
			fileOptions = 'UTF8';
			handler = uploadSrc;
			transform = toCsv;
			break;
		}

		default: {
			throw `Currently file type of ${fext} is not supported`;
		}
	}

	let [caslib, name] = output.split('.');
	return {
		source     : source,
		output     : { caslib: caslib, name: name.toLowerCase() },
		fileType   : fileType /* for cas actions */,
		fileExt    : fext,
		fileOptions: fileOptions,
		transform  : transform,
		contentType: contentType,
		handler    : handler
	};
	function toBase64 (data) {
		return new Buffer.from(data).toString('base64');
	}
	function toCsv (data, fileInfo) {
		// preprocess to get rid of things that upset datastep
		// eslint-disable-next-line no-control-regex
		let isrc = data.replace(/[^\x00-\x7F]/g, '');
		let src = isrc.replace(/\r?\n/g, '');
		// convert to a csv
		let fileType = fileInfo.fileExt;
		let varname =
			fileType === 'sas'
				? 'dataStepSrc'
				: fileType === 'ds2'
				? 'ds2Src'
				: fileType === 'casl'
				? 'caslSrc' : 'dataStepsrc';
		let csv =
			'modelName' +
			'\\' +
			varname +
			'\n' +
			fileInfo.output.name +
			'\\' +
			' ' +
			src +
			'\n';
		return csv;
	}

	function noChange (data) {
		return data;
	}
}
export default uploadSetup;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-casActionRun.html">casActionRun</a></li><li><a href="module-casFetchRows.html">casFetchRows</a></li><li><a href="module-caslRun.html">caslRun</a></li><li><a href="module-caslScore.html">caslScore</a></li><li><a href="module-casSetup.html">casSetup</a></li><li><a href="module-casTable.html">casTable</a></li><li><a href="module-casTableToJson.html">casTableToJson</a></li><li><a href="module-casUpdateData.html">casUpdateData</a></li><li><a href="module-computeFetchData.html">computeFetchData</a></li><li><a href="module-computeFileContent.html">computeFileContent</a></li><li><a href="module-computeResults.html">computeResults</a></li><li><a href="module-computeSetup.html">computeSetup</a></li><li><a href="module-computeSummary.html">computeSummary</a></li><li><a href="module-findReport.html">findReport</a></li><li><a href="module-getReportImage.html">getReportImage</a></li><li><a href="module-getReportUri.html">getReportUri</a></li><li><a href="module-getSASTableRows.html">getSASTableRows</a></li><li><a href="module-jesSetup.html">jesSetup</a></li><li><a href="module-jsonToDict.html">jsonToDict</a></li><li><a href="module-logLines.html">logLines</a></li><li><a href="module-masDescribe.html">masDescribe</a></li><li><a href="module-masRun.html">masRun</a></li><li><a href="module-masScore.html">masScore</a></li><li><a href="module-masSetup.html">masSetup</a></li><li><a href="module-uploadSetup.html">uploadSetup</a></li></ul><h3>Classes</h3><ul><li><a href="computeRun.html">computeRun</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sat Jul 30 2022 08:05:33 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
