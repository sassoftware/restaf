var t=require("@sassoftware/restaflib"),e=require("@sassoftware/restaf");function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},n.apply(this,arguments)}var r=function(t,e,n,r){try{var o=r.appControl.editControl.handlers;return null==o[t]?Promise.resolve([e,{statusCode:0,msg:null}]):Promise.resolve(o[t](e,n,r,t)).then(function(t){return[t[0],t[1]]})}catch(t){return Promise.reject(t)}},o=function(e,n){try{var r,o="cas"===n.source?Promise.resolve(function(e,n){try{var r=n.store,o=n.session,a=n.appControl.dataControl,s=a.table,u=a.byvars,i=n.state.columns,l={};if(null===u||0===u.length)return Promise.resolve(null);for(var c in e)"_index_"!==c&&!1===i[c].custom&&(l[c]=e[c]);var f={};return u.forEach(function(t){f[t]=l[t]}),Promise.resolve(t.casUpdateData(r,o,{table:s,data:l,where:f})).then(function(){return{statusCode:0,msg:"Save successful"}})}catch(t){return Promise.reject(t)}}(e,n)).then(function(t){r=t}):Promise.resolve(function(t,e){try{var n=e.store,r=e.session,o=e.appControl.dataControl,s=o.table,u=o.byvars;if(null===u||0===u.length)return Promise.resolve(null);var i="proc sql; update "+s.libref+"."+s.name,l="SET ",c=" ";for(var f in t)l=l+c+f+"="+a(t[f]),c=", ";i=i+" "+l;var m=" WHERE ",v=" ";u.forEach(function(e){m=m+v+e+"="+a(t[e]),v="AND "});var h=(i=i+" "+m+";run;").split(/\r?\n/);console.log(h);var d={data:{code:h}};return Promise.resolve(n.apiCall(r.links("execute"),d)).then(function(t){return Promise.resolve(n.jobState(t,{qs:{newState:"Completed",timeout:1}})).then(function(t){var e="completed"===t.data?0:1;return console.log(t),{statusCode:e,msg:t.data}})})}catch(t){return Promise.reject(t)}}(e,n)).then(function(t){r=t});return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(t){return Promise.reject(t)}};function a(t){return null==t?".":"string"==typeof t?JSON.stringify(t):t.toString()}function s(t,e,n){if(!t.s){if(n instanceof i){if(!n.s)return void(n.o=s.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(s.bind(null,t,e),s.bind(null,t,2));t.s=e,t.v=n;var r=t.o;r&&r(t)}}var u=function(t,e){try{var o=function(){var t={};if(a.forEach(function(e,n){var r=e.Column.toLowerCase();e.name=r,e.Label=null==e.Label||0===e.Label.length?e.Column:e.Label,e.custom=!1,t[r]=e}),null!=l)for(var e in l){var r=n({},l[e]);r.name=e,r.custom=!0,t[e]=r}return{columns:t,data:c}},a=t.schema,u=t.rows,l=e.appControl.dataControl.customColumns,c=[],f=(m=u,v=function(t){var n=function(t,e){var n={};if(e.forEach(function(e,r){var o=t[r],a=o.Column.toLowerCase();null==o.Label&&(o.Label=o.Column),n[a]=e}),null!=l)for(var r in l){var o=l[r],a=o.Column.toLowerCase();n[a]=o.value}return n}(a,u[t]);return Promise.resolve(r("init",n,t,e)).then(function(t){var e=t[0],n=t[1];0!==n.code&&console.log(JSON.stringify(n,null,4)),c.push(e)})},p=-1,function t(e){try{for(;++p<m.length;)if((e=v(p))&&e.then){if(!((n=e)instanceof i&&1&n.s))return void e.then(t,d||(d=s.bind(null,h=new i,2)));e=e.v}h?s(h,1,e):h=e}catch(t){s(h||(h=new i),2,t)}var n}(),h);return Promise.resolve(f&&f.then?f.then(o):o())}catch(t){return Promise.reject(t)}var m,v,h,d,p};const i=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,n){const r=new t,o=this.s;if(o){const t=1&o?e:n;if(t){try{s(r,1,t(this.v))}catch(t){s(r,2,t)}return r}return this}return this.o=function(t){try{const o=t.v;1&t.s?s(r,1,e?e(o):o):n?s(r,1,n(o)):s(r,2,o)}catch(t){s(r,2,t)}},r},t}();var l=function(e,r){try{var o=null,a="cas"===r.source?Promise.resolve(function(e,r){try{var o=r.store,a=r.session,s=n({},e);return null==s.table&&(s.table=r.appControl.dataControl.table),null==s.where&&(s.where={}),s.from<=0||-1===s.next?Promise.resolve(null):Promise.resolve(t.casFetchRows(o,a,s)).then(function(t){var e=null,o=function(){if(null!==t)return Promise.resolve(u(t.data,r)).then(function(o){e=o,r.state={modified:[],pagination:n({},t.pagination),currentPage:s,data:[],columns:[]},!0===r.appControl.dataControl.cachePolicy&&(r.state.data=e.data,r.state.columns=e.columns),e.pagination=n({},t.pagination)})}();return o&&o.then?o.then(function(){return e}):e})}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){o=t}):Promise.resolve(function(e,n){try{var r=n.store,o=n.tableSummary,a=n.appControl.dataControl.table,s=(a.libref+"."+a.name).toLowerCase();return Promise.resolve(t.computeFetchData(r,o,s,null,{qs:{start:e.from-1,limit:e.count,format:null==e.format&&e.format}})).then(function(t){var e=null,r=function(){if(null!==t)return Promise.resolve(u(t,n)).then(function(t){n.state={modified:[],pagination:{},currentPage:{},data:(e=t).data,columns:e.columns}})}();return r&&r.then?r.then(function(){return e}):e})}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){o=t});return Promise.resolve(a&&a.then?a.then(function(){return o}):o)}catch(t){return Promise.reject(t)}};exports.cellEdit=function(t,e,a,s,u){try{var i,l=function(t){return i?t:Promise.resolve(r("main",c,a,u)).then(function(t){var e;function n(n){return e?n:(c=t[0],h.msg=h.msg+" / "+t[1],!0===u.appControl.dataControl.cachePolicy&&(u.state.data[a]=c),{data:c,status:h})}var s=function(){if(!0===v)return Promise.resolve(r("term",t[0],a,u)).then(function(n){return 2===(h=(t=n)[1]).statusCode?(e=1,{data:t[0],status:h}):Promise.resolve(o(c,u)).then(function(){})})}();return s&&s.then?s.then(n):n(s)})},c=n({},null!==s?s:u.state.data[a]),f=u.appControl.editControl,m=f.handlers,v=f.autoSave;c[t]=function(t,e){var n=t;return"string"!=typeof n||"decimal"!==e.Type&&"number"!==e.Type&&"double"!==e.Type||(n=parseFloat(1*t),!0===isNaN(t)&&(t=0)),n}(e,u.state.columns[t]);var h={statusCode:0,msg:""},d=function(){if(null!=m[t])return Promise.resolve(m[t](c,t,a,u)).then(function(t){if(c=t[0],2===(h=t[1]).statusCode)return i=1,{data:t[0],status:h}})}();return Promise.resolve(d&&d.then?d.then(l):l(d))}catch(t){return Promise.reject(t)}},exports.commonHandler=r,exports.fetchTableRows=l,exports.scrollTable=function(e,r){try{var o,a="cas"===r.source?Promise.resolve(function(t,e){try{var r,o=e.appControl.dataControl,a=o.table;if("first"===t)(r=n({},o.initialFetch)).table=a;else if(-1===(r=e.state.pagination[t]).next)return Promise.resolve(null);return Promise.resolve(l(r,e))}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){o=t}):Promise.resolve(function(e,n){try{var r=n.store,o=n.tableSummary,a=n.appControl.dataControl.table,s=(a.libref+"."+a.name).toLowerCase();return Promise.resolve(t.computeFetchData(r,o,s,e,{qs:{limit:n.appControl.dataControl.initialFetch.count}})).then(function(t){var e=null,r=function(){if(null!==t)return Promise.resolve(u(t,n)).then(function(t){n.state={modified:[],pagination:{},currentPage:{},data:(e=t).data,columns:e.columns}})}();return r&&r.then?r.then(function(){return e}):e})}catch(t){return Promise.reject(t)}}(e,r)).then(function(t){o=t});return Promise.resolve(a&&a.then?a.then(function(){return o}):o)}catch(t){return Promise.reject(t)}},exports.setup=function(n,r){try{var o,a=function(){return o.appControl=r,o.id=Date(),o},s=e.initStore();null==n.authType&&(n.authType="code");var u=r.dataControl,i="cas"===u.source?Promise.resolve(t.casSetup(s,n)).then(function(t){o={source:u.source,store:s,session:t.session,servers:t.servers,restaflib:null,logonPayload:n,state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}}}}):Promise.resolve(t.computeSetup(s,null,n)).then(function(e){return Promise.resolve(t.computeSetupTables(s,e,u.table)).then(function(t){o={store:s,session:e,tableSummary:t,servers:null,restaflib:null,logonPayload:n,state:{modified:[],pagination:{},currentPage:{},data:{},columns:{}}}})});return Promise.resolve(i&&i.then?i.then(a):a())}catch(t){return Promise.reject(t)}},exports.updateTableRows=o;
//# sourceMappingURL=index.js.map
